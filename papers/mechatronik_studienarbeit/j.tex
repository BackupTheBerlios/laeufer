\section{Einleitung}

%--???--%
% Platine von 12V bis 48V

\section{Vorüberlegung: Zentralisiert oder Föderalistisch?}

Bevor wir uns in die faszinierende Welt der Datenübertragung stürzen, sollten wir, jedenfalls
für dieses spezielle Projekt, eine Grundsatzentscheidung treffen: Wollen wir ein möglich
zentral gesteuertes Netzwerk verwenden, in dem das Maximum an Entscheidungen vom PDA
getroffen wird, oder diese Entscheidungen, soweit möglich, den zu verwenden vorgesehenen SX-Platinen überlassen?


Ein Vorteil einer zentralistisch angelegten Steuerung scheint, jedenfalls bei einem Reisefahrzeug,
nur schwer erkennbar; der übliche Grund für solche Konstruktionen, die Minimierung von Redundanzen, greift
in einem Netz von konzeptionell ohnehin separaten Einheiten nicht. Somit sollten wir, um den
Datenübertragungsaufwand zu minimieren, nur mehr Konfigurationsinformationen vom PDA an die Peripherie,
und umgekehrt nur wirklich auf dem PDA notwendige Informationen versenden; letztere lassen sich zusammenfassend
als für den Fahrer gedachte Angaben-- Geschwindigkeit, Akkumulatorstand-- und zur Weiterleitung an andere
Geräte vorgesehene Informationen wie Zustände von als Peripherie angeschlossenen Lichtschaltern oder Blinker-Hebeln
beschreiben\footnote{Das Vorkommen der letztgenannten Informationen ist nicht zwingend erforderlich, falls
die Peripherie unmittelbar miteinander kommunizieren kann, z.B. durch eine Direktverbindung oder in einem
Multi-Master-Bussysstem.}.

\newpage

\section{Anforderungen an die Kommunikation}

Kommunikation, wenn nicht Selbstzweck-- wie bei allen Dingen-- muß an der Meßlatte
dessen beurteilt werden, was ihr Ziel und Zweck ist. Um von einer ``guten'' oder ``schlechten''
Lösung unsres Kommunikationsproblemes sprechen zu können, stellt sich uns somit zunächst die Aufgabe,
die zur Bemessung der gesuchten Qualität dienenden Kriterien niederzuschreiben und auszuformulieren,
nicht zuletzt gegeneinander abzuwägen, denn eine vollständige Ordnung muß sein, jedenfalls für ein
eindeutiges Urteil.

Das diese Abwägung nicht einfach sein muß, ist einleuchtend, doch führen wir sie trotz dieser
Vorüberlegung zunächst aus, um eine Beurteilungsbasis zu bilden. Was also sind jene Meßlatten,
die wir unsrer Kommunikationslösung anlegen wollen?

	\subsection{Korrektheit}

	Alle übertragenen Daten müssen korrekt sein.


	Zu diesem Punkt muß mehr gesagt werden, als sein Name hergibt. Korrektheit findet sich auf mehrere
	Arten und Weisen in unseren Forderungen wieder, die wir hier, milde axiomatisiert, auflisten wollen:

	\begin{enumerate}
	  \item{Wenn ein Datum den Empfänger nicht erreicht, muß der Sender davon erfahren}\label{j-correct-0}
	  \item{Wenn ein Datum den Empfänger erreicht, muß es zuvor versandt worden sein}\label{j-correct-1}
	  \item{Wenn ein Datum den Empfänger mehrfach erreicht, muß seine Semantik idempotent sein}\label{j-correct-2}
	\end{enumerate}

	Von diesen drei Forderungen ist insbesondere die Nummer \ref{j-correct-2} erläuterungsbedürftig. In Kommunikationssystemen
	kommt es erfahrungsgemäß vor, daß versandte Pakete aufgrund von unangemessen ausgelösten Fehlerbehandlungen (üblicherweise,
	wenn die Bestätigung der Gegenseite einem unbemerkten Übertragunsfehler zum Opfer fiel) wiederholt versandt werden.
	Unsre obige Forderung ist nun auf zwei Weisen erfüllbar, nämlich zum Einen, indem verhindert wird, daß
	der Empfänger die Botschaft mehrfach erhält, oder zum Anderen, indem auf einer höhergelegenen Interpretationsebene (auf die
	somit diese Fehlerbehandlung verschoben wird) der Doppelempfang ohne Folgen bleibt.

	Die erste Forderung ist in der Praxis auf eine sehr hohe Protokollebene verschiebbar, insbesondere, da wir Bidirektionalität fordern, ihr
	wesentlicher Vorteil, die Erkennung einer Situation, in der ein bestimmtes Gerät vom Netz abgetrennt wurde, jedoch in
	genau dieser Situation für dessen bedürfende Geräte durch erzwungene Antworten auf alle an den Empfänger gerichteten
	Anfragen erreicht werden kann.

	Diese drei Implikationen werden unsre Grundforderungen bilden. Da wir jedoch jenseits der Wunderbaren Welt der
	theoretischen Informatik operieren, werden sie natürlich nur ``in den allermeisten Fällen'' erfüllbar sein,
	aber diese Aussage bezieht sich natürlich auf alle unsre Forderungen. Diese speziellen Forderungen jedoch sind von der
	Art, in der sich wenig Verhandlungsspielraum-- im Gegensatz, zum Beispiel, zur Übertragungsgeschwindigkeit-- ergibt, somit
	müssen wir bei von uns gewählten Technologien stets auf ihre Erfüllung oder Erfüllbarkeit achten.

	\subsubsection{Bedeutung der Forderungen}

	Die Forderungen selbst sind übrigens durch ein triviales Modell bereits erfüllbar, einen {\it wissentlichen Nichtverschicker},
	der kein Datum versendet und den Sender davon in Kenntnis setzt (was die erste Forderung unmittelbar und die beiden anderen
	trivial erfüllt). Die Forderung, daß überhaupt Daten übertragen werden können, müssen wir somit auch ausdrücken.

	%

	\subsection{Hinreichende Datenübertragungsrate}

	Die Geschwindigkeit, mit der Daten übertragen werden, muß den Anforderungen des Projektes genügen.


	Diese Anforderung ist, in einer derartigen Formulierung, von kaum zu übertreffender Ungenauigkeit, doch eine
	präzise Formulierung der benötigten Datenübertragungsrate scheint in der gegebenen Situation kaum möglich, insbesondere,
	da die Menge der anzuschließenden Geräte nicht fest gegeben ist und somit nur eine Abschätzung gemacht werden kann,
	wieviel diese dann schließlich an ``laufenden'' Informationen benötigen beziehungsweise versenden.

	Unsre Vorüberlegung jedoch, den Geräten größtmögliche Autonomie zu gewähren, legt nahe, daß die Bandbreite überschaubar
	bleiben kann; betrachten wir dazu einen typischen Extremfall:

	\subsubsection{Schnelles Tachyometer}

	Typische Geschwindigkeitsmesser in verwandten Fahrzeugen werden oft nicht häufiger als zwei Mal pro Sekunde mit neuen
	Informationen versorgt; ein genauer auflösendes Tachyometer könnte zum Beispiel mit der Fernseh-typischen Rate von 25 Hz eine
	als ständig aktuell erscheinendende Qualität erreichen; bei 24 Bit Datenlast (8 Bit Kennziffer, 16 Bit Information)
	wären dies folglich, in diesem Beispiel, 600 bps für dieses eine Gerät.


	Auf die nächsthöhere glatte Zahl aufgerundet (um eventuellen Unwägsamkeiten, wie Datenverlust, zumindest in einem bescheidenen Maße
	vorzubeugen) wären dies 1024, für eine geschätzte Obergrenze von 16 Geräten also
	16384 bps im auf Datenlast eingeschränkten Übertragungsverkehr-- also Kontrolldaten ignorierend-- als theoretisches Minimum.
	Das ist, aus heutiger Sicht, nicht sehr viel, was aber, nach der Vorüberlegung, unsren Erwartungen grob entspricht.


	Bandbreite alleine reicht natürlich nicht unbedingt; die Erzählung vom mit CD-ROMs beladenen Güterzug als König der Bandbreite ist
	geläufig genug, um an eine andere häufige Forderung der Datenübertragung zu erinnern.

	%

	\subsection{Geringe Latenzzeiten}

	Die Zeit, die zwischen dem Versand und dem Eintreffen eines Datenpaketes vergeht, sollte minimal sein.


	Erneut eine eher vage Forderung, die an unsere Argumentation zur nicht-Zentralisiertheit erinnert. Wie 'minimal' die Verzögerung sein
	sollte, ist an praktischen Beispielen wohl-- abgesehen von offensichtlichen Beschränkungen-- am ehesten an einer doppelten
	Übertragung zwischen einem Schalter und einer anderen Peripherie, beispielsweise einem Scheinwerfer, erkennbar; hier machen sich
	hohe Latenzzeiten zwar nicht in einer gefährdenden, aber doch für den Fahrer ersichtlichen und irritierenden Weise
	bemerkbar. Bei einer nicht direkten Verdrahtung müßte also eine Übertragung zweier Botschaften innerhalb kurzer
	Zeit versandt werden können, bei
	direkter Kommunikationsmöglichkeit zwischen Schalter und Licht verringert sich dies auf eine einzelne Botschaft.

	Eine gute Latenzzeit für diesen Kommunikationsschritt wäre, wie im letzten Kriterium erwähnt, 0.04s; praktisch ausreichend
	wäre jedoch auch eine schlechtere Zeit von 0.1s, da, wie erwähnt, zu guter Letzt doch ``nur'' wieder das Empfinden des Fahrers bedient wird.

	Gerade an diesem Beispiel sieht man natürlich eine zuvor schon oft implizit erwähnte notwendige Anforderung, die als nächstes ausgeführt werden soll.

	%

	\subsection{Bidirektionalität}

	Kommunikation zwischen Peripherie und PDA sollte in beide Richtungen möglich sein.


	Diese Forderung ergibt sich unmittelbar aus der Notwendigkeit, Informationen, wie, zum Beispiel, die aktuelle Reisegeschwindigkeit,
	aus Peripheriegeräten auszulesen.

	%

	\subsection{Unterstützung für mehr als einen Client}

	Es sollte möglich sein, mehr als ein Peripheriegerät mit dem PDA kommunizieren zu lassen.


	Ähnlich wie beim vorherigen Punkt, der Bidirektionalität, ergibt sich diese Notwendigkeit aus praktischen Erwägungen. Eine
	Ermangelung an Bidirektionalität oder Mehr-Client-Funktionalität wäre zwar allgemein durch Verwendung mehrerer paralleler
	Kommunikationssysteme ausgleichbar, eine solche Konstruktion ist aufgrund des Hardware-Mehraufwandes und der grundsätzlich
	anderen Ansteuerung jedoch separat zu handhaben. Die angeklungene Forderung nach einem eher geringen Hardware-Aufwand läßt sich
	im Übrigen noch verallgemeinern, wie wir im nächsten Punkt sehen werden.
	%

	\subsection{Geringe Ressourcenanforderungen}

	Das verwendete Kommunikationssystem soll ``möglichst wenig'' Hardware, Strom, und Prozessorleistung der beteiligten Kommunikationssysteme
	benötigen.



	Eine präzisere Angabe jenseits von offensichtlichen Schranken des Machbaren sind hier nicht möglich; dies ist ein eher komparatives Kriterium.

	%

	\subsection{Praktische Realisierbarkeit mit gegebenen Mitteln}

	Das Kommunikationssystem muß an finanziellem und technischem Aufwand realistisch implementierbar sein.


	Insbesondere ist, rein komparativ gesehen, eine Unterstützung seitens der Sponsoren, sowohl materiell als auch
	mit Informationen und praktischer Unterstützung ein relevantes und jedenfalls im Zweifelsfall den Ausschlag gebendes Kriterium.
	%


	\subsection{Die Minimalanforderungen}\label{j-min-req}

	Um nun nicht unnötig auszuschließen, wollen wir unsre Minimalforderungen derart formulieren, daß der Ausgleich fehlender
	Eigenschaften auf einer höheren Ebene prinzipiell erlaubt sein soll, endgültiger Ausschluß einer Technologie würde also nur
	erfolgen, wenn sie das Erfüllen eines der Kriterien (in einem angemessenen Maß) prinzipiell ausschließen würde.

	Wir fordern von gewählten Technologien minimal, daß sie nicht ausschließen, daß folgende Kriterien erfüllt werden:
	\begin{enumerate}
	  \item{\bf Korrektheit}
	  \item{{\bf Hinreichende Datenübertragungsrate}: Mindestens 16384 bps für Daten alleine}
	  \item{{\bf Geringe Latenzzeit}: Maximal 0.05s pro Botschaft oder 0.1s für zwei Botschaften\footnote{Diese beiden Kriterien sind sehr unterschiedlich, da z.B. über Priorisierungsmechanismen unter Umständen sichergestellt werden kann, daß Botschaften, die eingingen, jedoch weiterversandt werden müssen, eine geringere Latenzzeit haben. Auf der anderen Seite jedoch ist es-- bei einer Latenz von konstant 0.05s-- durch zusätzlichen Bearbeitungsaufwand möglich, daß dennoch ein wenig mehr als 0.1s benötigt wird. Diese Zeit betrachten wir jedoch als unerheblich und verwenden somit 0.05s als ein einfacher zu handhabendes Kriterium.}}
	  \item{\bf Bidirektionalität}
	  \item{\bf Unterstützung für mindestens 16 Peripheriegeräte}
	  \item{{\bf Geringe Ressourcenanforderungen}: Strombedarf auf Platine abdeckbar, eventuelle Kabel maximal handelsübliche Koaxialkabel an Dicke, 
	    sonstige Hardware sollte maximal soviel Masse haben wie der Rest der SX-Platine}
	  \item{\bf Praktische Realisierbarkeit}
	\end{enumerate}


	Mit diesen sieben Kriterien werden wir nun die verschiedenen Möglichkeiten, die sich uns zur Kommunikation bieten,
	beurteilen.

\newpage

\section{Alternativen der Kommunikationshardware}

Wir werden nun eine Reihe von Alternativen durchgehen, die uns, verbunden mit verschiedenen Vor- und Nachteilen,
Kommunikation zwischen PDA und Peripherie erlauben. Im Falle einiger dieser Technologien könnten die benötigten Anschlüsse
zwar unmittelbar auf die SX-Board aufgelötet werden, eine Kommunikation mit dem PDA würde jedoch einer Zwischenstation, eines
Proxys, benötigen. Da auf den genannten Platinen ohnehin ein serieller Anschluß vorhanden ist, können sie, bei
entsprechender Programmierung, unmittelbar als ein solcher dienen (sofern die verwendete Kommunikationsmethode
der Forderung nach {\bf Bidirektionalität} genügt).\\

	\subsection{Einfache Hartverdrahtung}
	
	Die einfachsten Dinge sind oft auch die besten, daher wollen wir zunächst die Direktverbindung des PDAs mit der Peripherie über direkte
	Kabelverbindungen betrachten.

	Diese Lösung erfüllt zunächst unsre Minimalanforderungen, erlaubt beliebig viele Peripheriegeräte und ist an Bandbreite und Latenz nur durch
	den Systembus des SX-Controllers begrenzt. Doch schon hier stellt sich die erste Frage: Wie verbindet man die Controller direkt an ihrem
	Systembus? Ein Arbitrierungsmechanismus müßte herbei, es muß sichergestellt werden, daß keine Übertragungen verloren
	gehen\footnote{Erste Forderung der Korrektheit}. Aber
	damit haben wir schon wesentlich mehr als eine einfache Hartverdrahtung; wenn wir jedoch unser Modell beibehalten wollen, bliebe uns nur,
	die Peripherie direkt mit den Eingängen der SX-Ports zu verbinden. Dies würde natürlich die Anzahl der anschließbaren Peripheriegeräte unmittelbar
	beschränken-- die notwendigen 16 Geräte sollten jedoch kein prinzipielles Problem darstellen.

	Eine direkte Verbindung erzwingt jedoch einen unnötig komplexen Kabelbaum (wenn zwei Peripheriegeräte direkt
	nebeneinander liegen, ist es nicht ausreichend, sie miteinander zu verbinden-- jedes von ihnen muß einzeln verkabelt sein). Eine derartige
	Konstruktion würde Masse am Läufer kosten und wäre fehleranfällig; dennoch verbleibt die Hartverdrahtung als eine, wenn auch nicht
	optimale, Möglichkeit. Ihr Hauptvorteil, die hohe Geschwindigkeit und geringe Latenz (die durch zwischengeschaltete Verstärker
	jedoch geringfügig leiden dürfte) ist im Projektrahmen zwar interessant, aber nicht fundamental ausschlaggebend.
	
	%

	\subsection{Drahtlose Kommunikation}

	Die Zusammenfassung aller drahtlosen Kommunikationsmittel in einer einzigen Sektion legt das Urteil über diese natürlich bereits nahe,
	daher will ich es ohne Umschweife ausformulieren.

	Drahtlose Kommunikation benötigt mehr Leistung als hartverdrahtete Kommunikation und ist störungsanfälliger; da sie kein geschlossenes
	System erlaubt (jedenfalls nicht ohne harte Kryptographie, die jenseits der Schranken der praktischen Realisierbarkeit lag), ist
	somit auch die Erfüllung der Forderungen der Korrektheit nur schwerlich vorstellbar.
	%

	\subsection{Universal Serial Bus (USB)}
	%
%% -- fixme -- %%

	\subsection{IEEE 802}
	%
%% -- fixme -- %%

	\subsection{IEEE 1394 ,,Firewire''}
	%
%% -- fixme -- %%

	\subsection{Profibus}
	%
%% -- fixme -- %%

	\subsection{InterBus}
	%
%% -- fixme -- %%

	\subsection{Actuator Sensor Interface}
	%
%% -- fixme -- %%

	\subsection{Controller Area Network (CAN)}

	Das Controller Area Network, 1986 von der Robert Bosch AG zur
	Multi-Master-Kommunikation im Auftrag von Mercedes entwickelt,
	erfreut sich heutzutage einer wachsenden Beliebtheit auch bei
	anderen KFZ-Herstellern wie BMW, Porsche, Fiat etc., wird
	jedoch auch außerhalb der Automobilbranche genutzt.


	Das CAN-Protokoll ist ein reines Kommunikationsprotokoll
	(welches auch vielfach bereits in Hardware implementiert
	wurde), bezieht sich also nicht auf die	verwendeten
	physikalischen Transfermedien und die darübergelegene
	``Objektschicht'' (wie die darüberliegenden Schichten
	gem. OSI-Modell von der CAN-Spezifikation genannt
	werden). Zur Zeit existieren zwei relevante, im gleichen Netz
	ineroperable Protokollversionen:

	\subsubsection{CAN 1.2}
	Version 1.2 des Protokolls stellt Mechanismen zur
	Bus-Arbitrierung, Erkennung und Korrektur fehlerhafter
	Datenübertragungen und einen Standard-Adressraum von 11 Bits
	für angeschlossene Geräte zur Verfügung; aufgrund einer
	protokollbedingten Einschränkung ist jedoch ``nur''
	eine Adressierung von 2032 Busteilnehmern möglich.\\
	Ein zur unmittelbaren Datenübertragung verwendetes CAN-Frame
	(der Version 1.2) maximaler Größe beinhaltet 8 Bytes an Daten
	und belegt (inkl. Inter-frame space, dem Abstand zweier
	Frames) 111 Bit.\\
	Das Protokoll selbst läßt die genaue Hardware-Implementierung
	offen, gängig sind jedoch Raten von 1 Mb/s bei minimalem
	Verdrahtungsaufwand, was unsere Minimalanforderungen mehr als
	abdeckt.


	\subsubsection{CAN 2.0}
	Diese Protokollversion unterscheidet sich von CAN 1.2
	lediglich in der optionalen Verfügbarkeit von
	29-Bit-Bezeichnern\footnote{Die Einführung dieser Erweiterung
	begründet sich historisch aus von der American Society of
	Automative Engineers (SAE) gestellten Anforderungen}.

	%

	\subsection{Vehicle Area Network (VAN)}

	Dieses Netzwerk, in direkter Konkurrenz zum CAN, wurde in Frankreich entwickelt, scheint sich jedoch keiner vergleichbaren
	Popularität zu erfreuen. Ebenfalls als Multi-Master-fähiges
	Protokoll entworfen, wurde es 1994 ISO-standardisiert, hat
	jedoch keine (uns relevant erscheinenden) markanten Vorteile
	gegenüber seinem Konkurrenten.

	%

	\subsection{Konklusion}

%% -- fixme -- %%
\newpage

\section{Verbleibenden Anforderungen und Umsetzung}
	\subsection{Bereits durch CAN abgedeckte Anforderungen}
	Untersuchen wir nun die gestellten Anforderungen in Bezug auf bereits
	stattgefunden habende Abdeckung durch CAN selbst:

	\begin{enumerate}
	  \item{{\bf Korrektheit}: Wir erinnern uns an die drei geforderten Eigenschaften:
	    \begin{enumerate}
	    \item{{\it Wenn ein Datum den Empfänger nicht erreicht, muß der Sender davon erfahren}:
	      Diese Implikation wird von CAN nicht selbst erfüllt; ein erweiterndes Protokoll müßte
	      sie sich zur Aufgabe setzen. In unmittelbarem Zusammenhang damit ergibt sich ein praktisch
	      relevantes Problem: Kurzzeitige Leitunsstörungen können den Verlust einzelner Botschaften zur
	      Folge haben, ohne, daß die Kommunkation unbedingt zusammengebrochen wäre. Diese Situation
	      erfordert Neuversendungen der alten Daten, wird jedoch nicht von CAN abgedeckt, da dieses
	      Protokoll keine empfangenen Sendungen quittiert.
	    }
	    \item{{\it Wenn ein Datum den Empfänger erreicht, muß es zuvor versandt worden sein}:
	      Wird trivial von CAN erfüllt.}
	    \item{{\it Wenn ein Datum den Empfänger mehrfach erreicht, muß seine Semantik idempotent sein}:
	      Die Prämisse gilt in CAN nicht, somit muß die Konklusion nicht erfüllt werden.}
	    \end{enumerate}
	  }
	  \item{{\bf Hinreichende Transferrate}: Übliche Implementierungen liefern 1 Mb/s; bei Wahl eines hinreichend
	    intelligenten Protokolles sollte die gewünschte Mindest-Transferrate somit zu erreichen sein:
	    Eine solche Basis-Übertragungsrate liefert,
	    bei zwischen 111 ($1 \times 8$) und 440 ($8 \times 1$) Bits
	    für 8 Byte, also zwischen knapp 580000 und 145000 bps alleine für
	    Daten \footnote{falls keine Fehlerbehandlung nötig ist}, weit mehr,
	    als gefordert.
	  }
	  \item{{\bf Geringe Latenzzeiten}:
	    Die Latenzen in CAN sind, wie in Bus-Systemen üblich, minimal. Bei 111 für schlechtest
	    mögliche Frames liegt die Latenz unter 0.00012s, was darüberliegenden Protokollen viel
	    Freiraum einräumt.
	  }

	  \item{{\bf Bidirektionalität}:
	    CAN bietet, als Multi-Master-System, verschiedenste Möglichkeiten multidirektionaler Kommunikation.
	  }

	  \item{{\bf Unterstützung mehr als eines Clients}: Wie angedeutet, sieht CAN 1.2 eine Adressierung von bis zu 2032 Clients vor;
	    tatsächlich könnte durch spätere Auswahl auf den Empfangenen Daten diese Menge beliebig erweitert werden
	    (was im Rahmen dieses Projektes jedoch einer Begründbarkeit entbehren würde).}

	  \item{{\bf Geringe Ressourcenanforderungen}: Die aufgeführten Bedingungen (Subesektion \ref{j-min-req}) werden von der handelsüblichen Hardware
	    uneingeschränkt erfüllt.
	  }

	  \item{{\bf Praktische Realisierbarkeit}: Bei Verwendung dieser Technologie erhielten wir Unterstützung durch unsre
	    Sponsoren (von denen tatsächlich eine diesbezügliche Empfehlung ausgesprochen worden war).
	  }
	\end{enumerate}

	\subsection{Verbleibende Anforderungen}
	Die wesentliche verbleibende Anforderung ist somit die erste Forderung der Korrektheit, die eine Notifikation
	des Senders im Falle einer fehlgeschlagenen Übertragung voraussetzt. Bevor wir uns über die Bedeutung dieser Forderung
	klar werden


\newpage

\section{Alternativen für das Kommunikationsprotokoll}

Die Wahl des Bus-Systems (für das wir, auf externe Empfehlung hin, CAN-Controller vom Typ
MCP2510 der Firma Microchip Technology Inc.
verwenden), war somit gefallen. Diese liefern die bereits zuvor für diverse Abschätzungen verwendete Übertragungsrate
von 1 Mb/s

	\subsection{DeviceNet}
%% -- fixme: Mention it at the very least -- %%

	\subsection{CANopen}
%% -- fixme: Mention it at the very least -- %%

	\subsection{Smart Distributed System (SDS)}
%% -- fixme: Mention it at the very least -- %%


	\subsection{Eigenentwicklung}
	Zuletzt blieb nun noch die Möglichkeit einer auf die Bedürfnisse des Läufers zugeschnittenen Eigenlösung. Diese
	hatte zwar zunächst den unmittelbaren Nachteil, noch nicht entworfen worden zu sein, in Anbetracht der Nicht-
	verfügbarkeit existierender Implementierungen der andren genannten Protokolle für diese Plattform jedoch andererseits
	den Vorteil, mit moderaten Entwurfsaufwand den Implementierungsaufwand den Bedürfnissen des Läufers entsprechend
	zu gestalten.

	\subsection{Fazit}
	Schlußendlich fiel unsre Entscheidung schon sehr früh auf eine eigene Entwicklung, da der Aufwand für eine vollständige
	Implementierung bereits existierender Protokolle (soweit ihre Spezifikationen überhaupt öffentlich verfügbar waren) unseres
	Ermessens nach wesentlich höher gewesen wäre, wohingegen die Einschränkung eines dieser Protokolle keine
	merklichen Vorteile gegenüber einem solchen eignen Protokoll erwirkt hätte. 


\newpage

\section{Das Läufer-Protokoll für den CAN-Bus} 

Die Aufgaben des resultierenden Protokolls lassen sich nun wieder auf die bereits zuvor verwendeten Protokollkriterien zurückführen.
Hierbei muß jedoch darauf geachtet werden, die Eigenheiten des CAN-Protokolls zu beachten; die Protokolle haben also nicht nur zur
Aufgabe, unsere Korrektheitsforderungen zu erfüllen, sondern auch, eine gute Anbindung an CAN zu bieten-- wobei es sich von diesem
natürlich aus Gründen eines klaren Designs zumindest in seiner Spezifikation hinreichend weit abtrennen sollte.\\

Unsere Entscheidung fiel zugunsten eines zweischichtigen Protokolldesigns, in dem eines der Protokolle die grundsätzliche Kommunikation und das
andere einfaches Session-Management mit Timeouts spezifizierte. Die Trennung dieser beiden Dinge schien uns in Hinsicht auf die
bevorstehende Implementierung, aber auch aus Sicht der Modularität
sinnvoll.\\

Eine zunächst noch offene Frage war jedoch die Form der Protokolle,
gerade auch, da CAN Unterstützung für Multi-Mastering bietet. Wir
entschlossen uns zunächst dazu, das Session-Protokoll für eine
Master-Slave-Kommunikation auszulegen, da dies der angestrebten unmittelbaren
Kontrolle der Peripherie durch ein zentrales System entsprach; dies
erweiterten wir später um einen Notifikationsmechanismus in die andere
Richtung und bauten es somit zu einem zwei-Master-Netz aus.
Das Netzwerk-Protokoll hingegen, das auch die Aufgabe der
Adressierung bestimmter Clients übernehmen sollte, bildete ein
Multi-Master-System mit prioritisierten Botschaften (speziell unter Ausnutzung
der Eigenschaften des CAN-Busses), aus den gleichen Gründen.\\

Aus theoretischer Sicht ist das Netz somit von sternförmiger
Topologie, die tatsächliche Verdrahtung hingegen kann natürlich
beliebig im Rahmen des von CAN Ermöglichten erfolgen.

	\subsection{Die beiden Protokollschichten}
	Die beiden Protokolle, mit Namen {\it LLO} und {\it LLZ} (``Läufer Layer One'' bzw. ``Zero''), nehmen also
	zueinander signifikant andere Aufgaben wahr:

		\subsubsection{Aufgaben des LLO-Protokolls}
		Die Aufgaben des LLO-Protokolls umfassen die folgenden:
		\begin{enumerate}
		  \item{Adressierung der Klienten}
		  \item{Verpackung der zu übertragenden Daten in Pakete des Data Link/Network Layer (speziell CAN)}
		  \item{Busmastering}
		\end{enumerate}


		\subsubsection{Aufgaben des LLZ-Protokolls}
		Das LLZ-Protokoll übernimmt folgende Teilaufgaben:
		\begin{enumerate}
		  \item{Session-Management}
		  \item{Erfüllung des ersten Korrektheitskriteriums}
		\end{enumerate}
		Eine ``Sitzung'' im für uns relevanten Sinn erstreckt sich hierbei von Aktivierung bis Deaktivierung
		des Läufers.

		\subsubsection{Der sichere Betriebszustand}
		Beiden Protokollen ist ein Konzept zu Eigen, das den Namen ``sicherer Betriebszustand'' trägt, sich
		auf Klienten im Bus bezieht und
		individuell für jedes angeschlossene Gerät definiert werden muß. Dieser sichere Betriebszustand
		ist von angeschlossenen Geräten im Fehlerfall einzunehmen, insbesondere, wenn die Kommunikation nach
		außen abreißt.
\newpage

\section{Der Bezug zum OSI-Schichtenmodell}
Als kurzer Einschub soll hier noch einmal auf das OSI-Schichtenmodell
eingegangen werden, das zwar keinen leitenden Einfluß auf das Protokolldesign
hatte, wohl aber zur nachträglichen Klassifizierung verwendet werden kann.\\
In dem verwendeten Kommunikationssystem werden die Ebenen wie folgt belegt:

\begin{itemize}
  \item {{\bf Schicht 1: Physical Layer}: Diese Schicht findet sich in Verdrahtung, dem MCP2510, dem SX-Microcontroller, und den
    dazwischenliegenden Verbindungen.}
  \item {{\bf Schicht 2: Data Link Layer}: Die Fehlererkennung dieser Schicht ist im CAN-Protokoll spezifiziert, findet sich ent-
    sprechend physikalisch auf dem MCP2510.}
  \item {{\bf Schicht 3: Network Layer}: Ansteuerung der Komponenten wird, im Rahmen der CAN-spezifizierten Vorgaben, von einem
    von einer Implementierung des LLO-Protokolls realisiert. Die wesentliche Arbeit dabei wird durch Filtermechanismen im MCP2510
    realisiert.}
  \item {{\bf Schicht 4: Transport Layer}: Die Zerteilung in einzelne Pakete führt die LLO-Implementierung durch.}
  \item {{\bf Schicht 5: Session Layer}: Die Registrierung von Busteilnehmern und Timeout-Checks bei der Kommunikation werden
    von LLZ realisiert.}
  \item {{\bf Schicht 6: Presentation Layer}: Nach- bzw. Vorbearbeitung der übersandten Daten wird von Geräten und Treibern
    individuell gelöst und ist nicht Teil der hier beschriebenen Kommunikationsschicht.}
  \item {{\bf Schicht 7: Application Layer}: Die tatsächliche Durchreichung der Informationen an den Anwender, ihre optische
    Aufbereitung, automatische Beantwortung oder, allgemeiner, Versendung, findet sich in den anderen Teilen dieser Ausarbeitung
    beschrieben.}
\end{itemize}
    

\newpage

\section{Das LLO-Protokoll}\footnote{Die vollständige Protokollspezifikation findet sich als Anhang (Sektion {\ref llo-proto}).}


	\subsection{Struktur des Protokolls}
	\subsection{Umsetzung}
	\subsection{Tests}

\newpage

\section{Das LLZ-Protokoll}\footnote{Die vollständige Protokollspezifikation findet sich als Anhang (Sektion {\ref llz-proto}).}
	\subsection{Struktur des Protokolls}
	\subsection{Umsetzung}
	\subsection{Tests}

\newpage

\section{Fazit}
